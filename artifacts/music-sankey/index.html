<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ú—É–∑—ã–∫–∞–ª—å–Ω–∞—è –î–ù–ö ‚Äî Sankey</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/7.8.5/d3.min.js"></script>

    <style>
        :root {
            --text-primary: #fafafa;
            --text-muted: #a1a1aa;
            --text-dim: #71717a;
            --card-bg: #1f1f28;
            --card-border: #2a2a3a;
            --accent-blue: #60a5fa;
            --accent-green: #22c55e;
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a2e;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 50%, var(--bg-primary) 100%);
            font-family: 'Cormorant Garamond', Georgia, serif;
            color: var(--text-primary);
            min-height: 100vh;
            overflow-x: hidden;
        }
        .sankey-container { padding: 20px 20px; display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden; }
        .sankey-title { font-size: 1.8rem; font-weight: 600; margin-bottom: 4px; letter-spacing: 0.1em; background: linear-gradient(90deg, #fff 0%, #888 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sankey-subtitle { font-size: 12px; color: var(--text-muted); margin-bottom: 12px; font-family: 'JetBrains Mono', monospace; font-weight: 300; }
        #sankeyChart { width: 100%; max-width: 1400px; position: relative; }
        .sankey-link { fill: none; transition: stroke-opacity 0.15s; }
        .column-labels { display: flex; justify-content: space-between; width: 100%; max-width: 1400px; padding: 0 40px; margin-bottom: 6px; font-family: 'JetBrains Mono', monospace; font-size: 10px; letter-spacing: 0.15em; color: var(--text-muted); opacity: 0.5; }
        .artist-card { position: absolute; width: 70px; height: 70px; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 8px; padding: 6px; cursor: pointer; transition: all 0.2s ease; z-index: 10; }
        .artist-card .artist-info { position: absolute; left: 100%; top: 50%; transform: translateY(-50%); margin-left: 10px; white-space: nowrap; pointer-events: none; max-width: 120px; }
        .artist-card:hover, .artist-card.frozen { border-color: var(--accent-blue); transform: translateY(-2px); box-shadow: 0 8px 24px rgba(0,0,0,0.4); }
        .artist-card.frozen { border-color: var(--accent-green); box-shadow: 0 0 20px rgba(34, 197, 94, 0.3); }
        .artist-card.dimmed { opacity: 0.15; transform: scale(0.98); }
        .artist-card.highlighted { border-color: var(--accent-blue); box-shadow: 0 0 20px rgba(96, 165, 250, 0.3); }
        .artist-avatar { width: 100%; height: 100%; border-radius: 4px; position: relative; overflow: hidden; background-size: cover; background-position: center top; }
        .artist-avatar .fallback { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; font-size: 24px; opacity: 0; transition: opacity 0.3s; }
        .artist-avatar.no-img .fallback { opacity: 1; }
        .artist-name { font-family: 'JetBrains Mono', monospace; font-size: 11px; font-weight: 400; color: var(--text-primary); margin-bottom: 2px; }
        .artist-desc { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--text-dim); line-height: 1.3; }
        .genre-label, .trait-label { position: absolute; font-family: 'JetBrains Mono', monospace; font-size: 11px; cursor: pointer; transition: opacity 0.15s; }
        .genre-label { text-align: right; padding-right: 8px; }
        .trait-label { padding-left: 8px; display: flex; align-items: center; gap: 6px; }
        .genre-label.dimmed, .trait-label.dimmed { opacity: 0.15; }
        .genre-dot { display: inline-block; width: 8px; height: 8px; border-radius: 2px; margin-right: 6px; vertical-align: middle; }
        .trait-bar { width: 4px; height: 20px; border-radius: 2px; }
        .track-panel { position: fixed; right: 20px; top: 50%; transform: translateY(-50%); width: 300px; max-height: 75vh; background: var(--card-bg); border: 1px solid var(--card-border); border-radius: 12px; padding: 16px; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.2s; overflow-y: auto; }
        .track-panel.visible { opacity: 1; pointer-events: auto; }
        .track-panel.frozen { border-color: var(--accent-green); box-shadow: 0 0 30px rgba(34, 197, 94, 0.2); }
        .track-panel-header { display: flex; align-items: center; gap: 12px; margin-bottom: 12px; padding-bottom: 12px; border-bottom: 1px solid var(--card-border); }
        .track-panel-image { width: 64px; height: 64px; border-radius: 6px; overflow: hidden; flex-shrink: 0; background-size: cover; background-position: center; }
        .track-panel-title { font-family: 'JetBrains Mono', monospace; font-size: 14px; font-weight: 400; }
        .track-panel-subtitle { font-family: 'JetBrains Mono', monospace; font-size: 10px; color: var(--text-dim); }
        .track-panel-hint { font-family: 'JetBrains Mono', monospace; font-size: 9px; color: var(--accent-green); margin-top: 4px; }
        .track-list { list-style: none; }
        .track-item { display: flex; align-items: center; gap: 8px; padding: 8px; margin: 4px 0; border-radius: 6px; cursor: pointer; transition: background 0.15s; font-family: 'JetBrains Mono', monospace; font-size: 11px; }
        .track-item:hover { background: rgba(96, 165, 250, 0.15); }
        .track-item .spotify-icon { width: 16px; height: 16px; color: #1DB954; flex-shrink: 0; }
        .track-item .track-name { flex: 1; color: var(--text-primary); line-height: 1.3; }
        .track-item .track-arrow { color: var(--text-dim); font-size: 10px; }
        .close-btn { position: absolute; top: 12px; right: 12px; width: 24px; height: 24px; border: none; background: transparent; color: var(--text-muted); cursor: pointer; font-size: 18px; display: none; }
        .track-panel.frozen .close-btn { display: block; }
        .close-btn:hover { color: var(--text-primary); }
        @media (max-width: 1200px) { .artist-card { width: 60px; height: 60px; } .artist-name { font-size: 10px; } .track-panel { width: 260px; right: 10px; } }
        @media (max-width: 900px) { .sankey-container { padding: 20px 10px; } .sankey-title { font-size: 1.6rem; } .artist-card { width: 50px; height: 50px; padding: 4px; } .artist-name { font-size: 9px; } .artist-desc { display: none; } .genre-label, .trait-label { font-size: 9px; } .track-panel { width: 220px; } .artist-info { display: none; } }
    </style>
</head>
<body>
    <div class="sankey-container" id="container">
        <h1 class="sankey-title">–ú–£–ó–´–ö–ê–õ–¨–ù–ê–Ø –î–ù–ö</h1>
        <p class="sankey-subtitle">12 –∂–∞–Ω—Ä–æ–≤ ‚Üí 28 –∞—Ä—Ç–∏—Å—Ç–æ–≤ ‚Üí 8 —á–µ—Ä—Ç –ª–∏—á–Ω–æ—Å—Ç–∏</p>
        <div class="column-labels"><span>–ñ–ê–ù–†–´</span><span>–ê–†–¢–ò–°–¢–´</span><span>–õ–ò–ß–ù–û–°–¢–¨</span></div>
        <div id="sankeyChart"></div>
    </div>
    <div class="track-panel" id="trackPanel">
        <button class="close-btn" id="closeBtn">√ó</button>
        <div class="track-panel-header">
            <div class="track-panel-image" id="panelImage"></div>
            <div><div class="track-panel-title" id="panelTitle"></div><div class="track-panel-subtitle" id="panelSubtitle"></div><div class="track-panel-hint" id="panelHint"></div></div>
        </div>
        <ul class="track-list" id="trackList"></ul>
    </div>
    <script>
        // Local images path - for GitHub Pages use './images/'
        const imagePath = (filename) => `./images/${filename}`;

        const genres = [
            { id: 'soviet-rock', name: '–†—É—Å—Å–∫–∏–π —Ä–æ–∫', color: '#ff6b6b' },
            { id: 'protest', name: '–ü—Ä–æ—Ç–µ—Å—Ç', color: '#ffd93d' },
            { id: 'world', name: 'World Music', color: '#6bcb77' },
            { id: 'spiritual', name: '–ú–µ–¥–∏—Ç–∞—Ç–∏–≤', color: '#9d4edd' },
            { id: 'author', name: '–ê–≤—Ç–æ—Ä—Å–∫–∞—è –ø–µ—Å–Ω—è', color: '#4ecdc4' },
            { id: 'neofolk', name: '–ù–µ–æ—Ñ–æ–ª–∫', color: '#a0522d' },
            { id: 'electronic', name: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', color: '#00d4ff' },
            { id: 'virtuoso', name: '–í–∏—Ä—Ç—É–æ–∑—ã', color: '#ff9f1c' },
            { id: 'irony', name: '–ò—Ä–æ–Ω–∏—è', color: '#ff85a2' },
            { id: 'soundtrack', name: '–°–∞—É–Ω–¥—Ç—Ä–µ–∫–∏', color: '#7b68ee' },
            { id: 'modern-rap', name: '–†—ç–ø', color: '#e63946' },
            { id: 'melancholy', name: '–ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è', color: '#457b9d' },
        ];

        const artists = [
            { id: 'a1', name: '–ö–ò–ù–û', desc: '–í–∏–∫—Ç–æ—Ä –¶–æ–π, —Ä—É—Å—Å–∫–∏–π —Ä–æ–∫ 80-—Ö', emoji: '‚≠ê', bgColor: '#ff6b6b',
              image: 'kino.jpg', imagePos: 'center 15%',
              tracks: [{ title: '–ü–µ—Ä–µ–º–µ–Ω', search: '–ö–ò–ù–û –ü–µ—Ä–µ–º–µ–Ω', year: 1986 },{ title: '–ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏', search: '–ö–ò–ù–û –ì—Ä—É–ø–ø–∞ –∫—Ä–æ–≤–∏', year: 1988 },{ title: '–ì–æ—Ä–æ–¥', search: '–ö–ò–ù–û –ì–æ—Ä–æ–¥', year: 1982 },{ title: '–ú—É—Ä–∞–≤–µ–π–Ω–∏–∫', search: '–ö–ò–ù–û –ú—É—Ä–∞–≤–µ–π–Ω–∏–∫', year: 1986 }]},
            { id: 'a2', name: '–í—ã—Å–æ—Ü–∫–∏–π', desc: '–ë–∞—Ä–¥, –ø–æ—ç—Ç, –∞–∫—Ç—ë—Ä', emoji: 'üé≠', bgColor: '#4ecdc4',
              image: 'vysotsky.jpg', imagePos: 'center top',
              tracks: [{ title: '–ú–æ–π –ì–∞–º–ª–µ—Ç', search: '–í—ã—Å–æ—Ü–∫–∏–π –ú–æ–π –ì–∞–º–ª–µ—Ç', year: 1972 },{ title: '–Ø–∫-–∏—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å', search: '–í—ã—Å–æ—Ü–∫–∏–π –Ø–∫-–∏—Å—Ç—Ä–µ–±–∏—Ç–µ–ª—å', year: 1968 },{ title: '–ü–µ—Å–Ω—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –Ω–µ–≥–æ–¥—è–µ–≤', search: '–í—ã—Å–æ—Ü–∫–∏–π –ü–µ—Å–Ω—è –∫–æ—Å–º–∏—á–µ—Å–∫–∏—Ö –Ω–µ–≥–æ–¥—è–µ–≤', year: 1981 }]},
            { id: 'a3', name: 'Noize MC', desc: '–ü—Ä–æ—Ç–µ—Å—Ç–Ω—ã–π —Ä—ç–ø, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ª–∏—Ä–∏–∫–∞', emoji: 'üî•', bgColor: '#ffd93d',
              image: 'noize-mc.jpg', imagePos: 'center 20%',
              tracks: [{ title: '–ò–æ—Ä–¥–∞–Ω', search: 'Noize MC –ò–æ—Ä–¥–∞–Ω', year: 2018 },{ title: '–í—Å—ë –∫–∞–∫ —É –ª—é–¥–µ–π', search: 'Noize MC –í—Å—ë –∫–∞–∫ —É –ª—é–¥–µ–π', year: 2016 },{ title: '–°—Ç–æ–ª–µ—Ç–Ω—è—è –≤–æ–π–Ω–∞', search: 'Noize MC –°—Ç–æ–ª–µ—Ç–Ω—è—è –≤–æ–π–Ω–∞', year: 2016 },{ title: '–í–æ—è–¥–∂–µ—Ä-1', search: 'Noize MC –í–æ—è–¥–∂–µ—Ä', year: 2018 },{ title: '–ü–æ—á–∏—Ç–∞–π —Å—Ç–∞—Ä—à–∏—Ö', search: 'Noize MC –ü–æ—á–∏—Ç–∞–π —Å—Ç–∞—Ä—à–∏—Ö', year: 2024 }]},
            { id: 'a4', name: '–ë–ì', desc: '–ê–∫–≤–∞—Ä–∏—É–º, –¥—É—Ö–æ–≤–Ω—ã–µ –ø–æ–∏—Å–∫–∏', emoji: 'üïâÔ∏è', bgColor: '#9d4edd',
              image: 'bg.jpg', imagePos: 'center 35%',
              tracks: [{ title: 'Om Namah Shivaya', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ Om Namah Shivaya', year: 2012 },{ title: '–ü–æ–µ–∑–¥ –≤ –æ–≥–Ω–µ', search: '–ê–∫–≤–∞—Ä–∏—É–º –ü–æ–µ–∑–¥ –≤ –æ–≥–Ω–µ', year: 1987 },{ title: '–í–æ–Ω –í–∞–≤–∏–ª–æ–Ω', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ –í–æ–Ω –í–∞–≤–∏–ª–æ–Ω', year: 2017 },{ title: '–ù–∞–∑–∞–¥ –≤ –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫', search: '–ê–∫–≤–∞—Ä–∏—É–º –ù–∞–∑–∞–¥ –≤ –ê—Ä—Ö–∞–Ω–≥–µ–ª—å—Å–∫', year: 1982 },{ title: '–ú–æ–ª–∏—Ç–≤–∞ –∏ –ø–æ—Å—Ç', search: '–ê–∫–≤–∞—Ä–∏—É–º –ú–æ–ª–∏—Ç–≤–∞ –∏ –ø–æ—Å—Ç', year: 1999 },{ title: '–ù–æ–≤—ã–π –®—ë–ª–∫–æ–≤—ã–π –ü—É—Ç—å', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ –ù–æ–≤—ã–π –®–µ–ª–∫–æ–≤—ã–π –ü—É—Ç—å', year: 2011 },{ title: '–ï—Å–ª–∏ –Ø –£–π–¥—É', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ –ï—Å–ª–∏ –Ø –£–π–¥—É', year: 2007 },{ title: '–ù–µ —Å—É–¥—å–±–∞', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ –ù–µ —Å—É–¥—å–±–∞', year: 2018 },{ title: '–ù–µ –ë—ã–ª–æ –¢–∞–∫–æ–π', search: '–ì—Ä–µ–±–µ–Ω—â–∏–∫–æ–≤ –ù–µ –ë—ã–ª–æ –¢–∞–∫–æ–π', year: 2016 }]},
            { id: 'a5', name: '–í–∞—Å–∏–ª–∏–π –ö.', desc: '–ê–≤—Ç–æ—Ä—Å–∫–∏–π —Å–∞—Ä–∫–∞–∑–º –∏ –∏—Ä–æ–Ω–∏—è', emoji: 'üòè', bgColor: '#ff85a2',
              image: 'vasiliy-k.jpg', imagePos: 'center 30%',
              tracks: [{ title: '–ù–µ –º–æ—è', search: '–í–∞—Å–∏–ª–∏–π –ö –ù–µ –º–æ—è', year: 2008 },{ title: '–î–µ—Ä–∂–∞–≤–∞', search: '–í–∞—Å–∏–ª–∏–π –ö –î–µ—Ä–∂–∞–≤–∞', year: 2010 },{ title: '–ì–∞–Ω–µ—à–∞', search: '–í–∞—Å–∏–ª–∏–π –ö –ì–∞–Ω–µ—à–∞', year: 2012 },{ title: '–ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç—ã', search: '–í–∞—Å–∏–ª–∏–π –ö –ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ç—ã', year: 2006 },{ title: '–°–∞–º–æ–µ —Ö—É–¥—à–µ–µ', search: '–í–∞—Å–∏–ª–∏–π –ö –°–∞–º–æ–µ —Ö—É–¥—à–µ–µ', year: 2015 },{ title: '–ú–æ–Ω–æ—Ç–µ–∏–∑–º', search: '–í–∞—Å–∏–ª–∏–π –ö –ú–æ–Ω–æ—Ç–µ–∏–∑–º', year: 2006 },{ title: '–ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω –∏ –ë–µ—Ä–ª–∏–Ω', search: '–í–∞—Å–∏–ª–∏–π –ö –ú–∞–Ω—Ö—ç—Ç—Ç–µ–Ω –∏ –ë–µ—Ä–ª–∏–Ω', year: 2018 },{ title: '–¢–∞–∫ –±—ã–≤–∞–µ—Ç', search: '–í–∞—Å–∏–ª–∏–π –ö –¢–∞–∫ –±—ã–≤–∞–µ—Ç', year: 2015 },{ title: '–ë–µ–∑–æ–±—Ä–∞–∑–Ω—ã –∏ –∑–ª—ã', search: '–í–∞—Å–∏–ª–∏–π –ö –ë–µ–∑–æ–±—Ä–∞–∑–Ω—ã –∏ –∑–ª—ã', year: 2015 },{ title: '–ò—Å—É—Å—ã –•—Ä–∏—Å—Ç–æ—Å—ã', search: '–í–∞—Å–∏–ª–∏–π –ö –ò—Å—É—Å—ã –•—Ä–∏—Å—Ç–æ—Å—ã', year: 2006 },{ title: '–ò–≥—Ä–∞ –≤ —è—â–∏–∫', search: '–í–∞—Å–∏–ª–∏–π –ö –ò–≥—Ä–∞ –≤ —è—â–∏–∫', year: 2018 }]},
            { id: 'a6', name: 'Heilung', desc: '–°–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–∏–π –ø–µ–π–≥–∞–Ω', emoji: 'ü¶å', bgColor: '#a0522d',
              image: 'heilung.jpg', imagePos: 'center 35%',
              tracks: [{ title: 'Fylgija Ear', search: 'Heilung Fylgija Ear', year: 2019 },{ title: 'Hakkerskaldyr', search: 'Heilung Hakkerskaldyr', year: 2019 }]},
            { id: 'a7', name: 'Hans Zimmer', desc: '–≠–ø–∏—á–µ—Å–∫–∏–µ —Å–∞—É–Ω–¥—Ç—Ä–µ–∫–∏', emoji: 'üé¨', bgColor: '#7b68ee',
              image: 'hans-zimmer.jpg', imagePos: 'center 25%',
              tracks: [{ title: 'Interstellar Suite', search: 'Hans Zimmer Interstellar Suite', year: 2014 },{ title: 'Dust', search: 'Hans Zimmer Dust Interstellar', year: 2014 }]},
            { id: 'a8', name: 'Rodrigo y Gabriela', desc: '–í–∏—Ä—Ç—É–æ–∑—ã –∞–∫—É—Å—Ç–∏—á–µ—Å–∫–æ–π –≥–∏—Ç–∞—Ä—ã', emoji: 'üé∏', bgColor: '#ff9f1c',
              image: 'rodrigo-gabriela.jpg', imagePos: 'center 20%',
              tracks: [{ title: 'Electric Soul', search: 'Rodrigo y Gabriela Electric Soul', year: 2019 },{ title: 'Ixtapa', search: 'Rodrigo y Gabriela Ixtapa', year: 2006 }]},
            { id: 'a9', name: '–ö–∞—Å—Ç–∞', desc: '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π —Ä—ç–ø –†–æ—Å—Ç–æ–≤–∞', emoji: 'üé§', bgColor: '#e63946',
              image: '_kasta.jpg', imagePos: 'center 15%',
              tracks: [{ title: '–°–∞–º—ã–π —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫', search: '–ö–∞—Å—Ç–∞ –°–∞–º—ã–π —Å—á–∞—Å—Ç–ª–∏–≤—ã–π —á–µ–ª–æ–≤–µ–∫', year: 2007 },{ title: '–ù–∞ –ø–æ—Ä—è–¥–æ–∫ –≤—ã—à–µ', search: '–ö–∞—Å—Ç–∞ –ù–∞ –ø–æ—Ä—è–¥–æ–∫ –≤—ã—à–µ', year: 2009 },{ title: '–†–∞–¥–∏–æ—Å–∏–≥–Ω–∞–ª—ã', search: '–ö–∞—Å—Ç–∞ –†–∞–¥–∏–æ—Å–∏–≥–Ω–∞–ª—ã', year: 2017 },{ title: '–ì–æ—Ä—è—á–µ–µ –≤—Ä–µ–º—è', search: '–ö–∞—Å—Ç–∞ –ì–æ—Ä—è—á–µ–µ –≤—Ä–µ–º—è', year: 2006 }]},
            { id: 'a10', name: 'Nick Cave', desc: '–¢—ë–º–Ω–∞—è —Ä–æ–º–∞–Ω—Ç–∏–∫–∞, –≥–æ—Ç–∏–∫–∞', emoji: 'üñ§', bgColor: '#457b9d',
              image: 'nick-cave.jpg', imagePos: 'center 25%',
              tracks: [{ title: 'Papa Won\'t Leave You, Henry', search: 'Nick Cave Papa Wont Leave You Henry', year: 1994 },{ title: 'Red Right Hand', search: 'Nick Cave Red Right Hand', year: 1994 },{ title: 'Brother, My Cup Is Empty', search: 'Nick Cave Brother My Cup Is Empty', year: 1996 }]},
            { id: 'a11', name: 'Nine Treasures', desc: '–ú–æ–Ω–≥–æ–ª—å—Å–∫–∏–π —Ñ–æ–ª–∫-–º–µ—Ç–∞–ª', emoji: 'üèîÔ∏è', bgColor: '#6bcb77',
              image: 'nine-treasures.jpg', imagePos: 'center 40%',
              tracks: [{ title: 'The Dream About Ancient City', search: 'Nine Treasures Dream Ancient City', year: 2017 }]},
            { id: 'a12', name: 'Jean-Michel Jarre', desc: '–ü–∏–æ–Ω–µ—Ä —ç–ª–µ–∫—Ç—Ä–æ–Ω–Ω–æ–π –º—É–∑—ã–∫–∏', emoji: 'üåå', bgColor: '#00d4ff',
              image: 'jarre.jpg', imagePos: 'center 15%',
              tracks: [{ title: 'Equinoxe, Pt. 4', search: 'Jean Michel Jarre Equinoxe 4', year: 1978 }]},
            { id: 'a13', name: '–ü—É—à–Ω–æ–π', desc: '–ò—Ä–æ–Ω–∏—á–Ω—ã–π –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª', emoji: 'ü§ì', bgColor: '#ff85a2',
              image: 'pushnoy.jpg', imagePos: 'center 15%',
              tracks: [{ title: '–í–µ—Ä—à–∏–Ω–∞', search: '–ü—É—à–Ω–æ–π –í–µ—Ä—à–∏–Ω–∞', year: 2007 },{ title: '–ì–æ—Ä–æ–¥ –û–º—Å–∫', search: '–ü—É—à–Ω–æ–π –ì–æ—Ä–æ–¥ –û–º—Å–∫', year: 2010 },{ title: '–ù–∞–¥–æ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è!', search: '–ü—É—à–Ω–æ–π –ù–∞–¥–æ —Ä–∞–¥–æ–≤–∞—Ç—å—Å—è', year: 2008 }]},
            { id: 'a14', name: 'Oxxxymiron', desc: '–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω—ã–π –±–∞—Ç—Ç–ª-—Ä—ç–ø', emoji: 'üìö', bgColor: '#ffd93d',
              image: 'oxxxymiron.jpg', imagePos: 'center 15%',
              tracks: [{ title: '–ì–¥–µ –Ω–∞—Å –Ω–µ—Ç', search: 'Oxxxymiron –ì–¥–µ –Ω–∞—Å –Ω–µ—Ç', year: 2015 },{ title: '–ì–æ—Ä–æ–¥ –ø–æ–¥ –ø–æ–¥–æ—à–≤–æ–π', search: 'Oxxxymiron –ì–æ—Ä–æ–¥ –ø–æ–¥ –ø–æ–¥–æ—à–≤–æ–π', year: 2015 },{ title: '–û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø', search: 'Oxxxymiron –û–†–ì–ê–ù–ò–ó–ê–¶–ò–Ø', year: 2022 },{ title: '–õ–æ–Ω–¥–æ–Ω–≥—Ä–∞–¥', search: 'Oxxxymiron –õ–æ–Ω–¥–æ–Ω–≥—Ä–∞–¥', year: 2015 }]},
            { id: 'a15', name: 'Corvus Corax', desc: '–°—Ä–µ–¥–Ω–µ–≤–µ–∫–æ–≤—ã–π –Ω–µ–æ—Ñ–æ–ª–∫', emoji: 'üè∞', bgColor: '#a0522d',
              image: 'corvus-corax.jpg', imagePos: 'center 25%',
              tracks: [{ title: 'In Taberna', search: 'Corvus Corax In Taberna', year: 1992 },{ title: 'Sk√°l', search: 'Corvus Corax Skal', year: 2013 }]},
            { id: 'a16', name: 'Krishna Das', desc: '–ö–∏—Ä—Ç–∞–Ω, –º–∞–Ω—Ç—Ä—ã', emoji: 'üôè', bgColor: '#9d4edd',
              image: 'krishna-das.jpg', imagePos: 'center 20%',
              tracks: [{ title: 'Hallelujah Chalisa', search: 'Krishna Das Hallelujah Chalisa', year: 2014 }]},
            { id: 'a17', name: '–°–ø–ª–∏–Ω', desc: '–ü–∏—Ç–µ—Ä—Å–∫–∏–π —Ä–æ–∫, –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –ª–∏—Ä–∏–∫–∞', emoji: 'üåßÔ∏è', bgColor: '#457b9d',
              image: '',
              tracks: [{ title: '–ó–∞ —Å–µ–º—å—é –ø–µ—á–∞—Ç—è–º–∏', search: '–°–ø–ª–∏–Ω –ó–∞ —Å–µ–º—å—é –ø–µ—á–∞—Ç—è–º–∏', year: 2004 },{ title: '–ù–µ—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –≤–Ω—É—Ç—Ä–∏', search: '–°–ø–ª–∏–Ω –ù–µ—á–µ–≥–æ –¥–µ–ª–∞—Ç—å –≤–Ω—É—Ç—Ä–∏', year: 2001 },{ title: '–°–µ–º—å –≤–æ—Å—å–º—ã—Ö', search: '–°–ø–ª–∏–Ω –°–µ–º—å –≤–æ—Å—å–º—ã—Ö', year: 1998 },{ title: '–ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç—Ç–æ –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä—É', search: '–°–ø–ª–∏–Ω –ü–µ—Ä–µ–¥–∞–π—Ç–µ —ç—Ç–æ –ì–∞—Ä—Ä–∏ –ü–æ—Ç—Ç–µ—Ä—É', year: 2001 }]},
            { id: 'a18', name: '–î–µ–ª—å—Ñ–∏–Ω', desc: '–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –º–µ–ª–∞–Ω—Ö–æ–ª–∏—è', emoji: 'üê¨', bgColor: '#1e3a5f',
              image: '',
              tracks: [{ title: '744', search: '–î–µ–ª—å—Ñ–∏–Ω 744', year: 2014 },{ title: '–Ø –ª—é–±–ª—é –ª—é–¥–µ–π', search: '–î–µ–ª—å—Ñ–∏–Ω –Ø –ª—é–±–ª—é –ª—é–¥–µ–π', year: 2005 }]},
            { id: 'a19', name: '–ü–æ—Ä–Ω–æ—Ñ–∏–ª—å–º—ã', desc: '–°–æ—Ü–∏–∞–ª—å–Ω—ã–π –ø–∞–Ω–∫-—Ä–æ–∫', emoji: 'üî•', bgColor: '#dc2626',
              image: '',
              tracks: [{ title: '–Ø —Ç–∞–∫ —Å–æ—Å–∫—É—á–∏–ª—Å—è', search: '–ü–æ—Ä–Ω–æ—Ñ–∏–ª—å–º—ã –Ø —Ç–∞–∫ —Å–æ—Å–∫—É—á–∏–ª—Å—è', year: 2017 },{ title: '–ß—É–∂–æ–µ –≥–æ—Ä–µ', search: '–ü–æ—Ä–Ω–æ—Ñ–∏–ª—å–º—ã –ß—É–∂–æ–µ –≥–æ—Ä–µ', year: 2018 },{ title: '–†–æ—Å—Å–∏—è –¥–ª—è –≥—Ä—É—Å—Ç–Ω—ã—Ö', search: '–ü–æ—Ä–Ω–æ—Ñ–∏–ª—å–º—ã –†–æ—Å—Å–∏—è –¥–ª—è –≥—Ä—É—Å—Ç–Ω—ã—Ö', year: 2019 }]},
            { id: 'a20', name: '–õ–µ–æ–Ω–∞', desc: '–¢—ë–º–Ω—ã–π –∞–≤—Ç–æ—Ä—Å–∫–∏–π —Ñ–æ–ª–∫', emoji: 'üåë', bgColor: '#374151',
              image: '',
              tracks: [{ title: '–•–æ–∑—è–π–∫–∞ –º–µ–¥–Ω–æ–π –≥–æ—Ä—ã', search: '–õ–µ–æ–Ω–∞ –•–æ–∑—è–π–∫–∞ –º–µ–¥–Ω–æ–π –≥–æ—Ä—ã', year: 2018 },{ title: '–ü–ª–æ—Ö–æ, –Ω–∏—á–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ', search: '–õ–µ–æ–Ω–∞ –ü–ª–æ—Ö–æ –Ω–∏—á–µ–≥–æ —Ö–æ—Ä–æ—à–µ–≥–æ', year: 2019 },{ title: '–ü—É—Å—Ç–æ–µ —Å–≤—è—Ç–æ–µ', search: '–õ–µ–æ–Ω–∞ –ü—É—Å—Ç–æ–µ —Å–≤—è—Ç–æ–µ', year: 2019 },{ title: '–ó–≤–µ—Ä—å, –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –±—ã–≤–∞–µ—Ç', search: '–õ–µ–æ–Ω–∞ –ó–≤–µ—Ä—å –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ –±—ã–≤–∞–µ—Ç', year: 2020 },{ title: '–ü—Ä–æ–≤–æ–¥–Ω–∏–∫', search: '–õ–µ–æ–Ω–∞ –ü—Ä–æ–≤–æ–¥–Ω–∏–∫', year: 2018 },{ title: '–ù–∞ –º–µ—Ç–∞–ª–ª–æ–ª–æ–º–µ', search: '–õ–µ–æ–Ω–∞ –ù–∞ –º–µ—Ç–∞–ª–ª–æ–ª–æ–º–µ', year: 2019 },{ title: '–í—Å—ë, —á—Ç–æ –º—ã —Å–∫–∞–∂–µ–º', search: '–õ–µ–æ–Ω–∞ –í—Å—ë —á—Ç–æ –º—ã —Å–∫–∞–∂–µ–º', year: 2020 }]},
            { id: 'a21', name: 'Anacondaz', desc: '–ò—Ä–æ–Ω–∏—á–Ω—ã–π —Ä—ç–ø-—Ä–æ–∫', emoji: 'üêç', bgColor: '#65a30d',
              image: '',
              tracks: [{ title: '–î—É–±–∞–∫', search: 'Anacondaz –î—É–±–∞–∫', year: 2015 },{ title: '–°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ', search: 'Anacondaz –°–º–µ—Ä—Ç–µ–ª—å–Ω–æ–µ –æ—Ä—É–∂–∏–µ', year: 2018 }]},
            { id: 'a22', name: 'Nautilus Pompilius', desc: '–ö–ª–∞—Å—Å–∏–∫–∞ —Ä—É—Å—Å–∫–æ–≥–æ —Ä–æ–∫–∞', emoji: 'üêö', bgColor: '#0ea5e9',
              image: '',
              tracks: [{ title: '–Ø —Ö–æ—á—É –±—ã—Ç—å —Å —Ç–æ–±–æ–π', search: 'Nautilus Pompilius –Ø —Ö–æ—á—É –±—ã—Ç—å —Å —Ç–æ–±–æ–π', year: 1989 },{ title: '–•–ª–æ–ø-—Ö–ª–æ–ø', search: 'Nautilus Pompilius –•–ª–æ–ø-—Ö–ª–æ–ø', year: 1988 }]},
            { id: 'a23', name: '–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –æ–±–æ—Ä–æ–Ω–∞', desc: '–°–∏–±–∏—Ä—Å–∫–∏–π –ø–∞–Ω–∫, –õ–µ—Ç–æ–≤', emoji: 'üíÄ', bgColor: '#1f2937',
              image: '',
              tracks: [{ title: '–ü–æ—Å–ª–µ –Ω–∞—Å', search: '–ì—Ä–∞–∂–¥–∞–Ω—Å–∫–∞—è –æ–±–æ—Ä–æ–Ω–∞ –ü–æ—Å–ª–µ –Ω–∞—Å', year: 2004 }]},
            { id: 'a24', name: '–ê–ª–∏—Å–∞', desc: '–ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω –ö–∏–Ω—á–µ–≤, —Ä–æ–∫', emoji: '‚ö°', bgColor: '#b91c1c',
              image: '',
              tracks: [{ title: 'Rock-N-Roll', search: '–ê–ª–∏—Å–∞ Rock-N-Roll', year: 1988 }]},
            { id: 'a25', name: '–í–ª–∞–¥–∏', desc: '–ö–∞—Å—Ç–∞ —Å–æ–ª–æ, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –ª–∏—Ä–∏–∫–∞', emoji: 'üé§', bgColor: '#7c3aed',
              image: '',
              tracks: [{ title: '–ö–∞–∫ —ç—Ç–æ –±–ª—è–¥—å –≤–æ–∑–º–æ–∂–Ω–æ', search: '–í–ª–∞–¥–∏ –ö–∞–∫ —ç—Ç–æ –≤–æ–∑–º–æ–∂–Ω–æ', year: 2022 },{ title: '–ö—Ä–∞—Å–∫–∏ –Ω–µ —Å–≥—É—â–∞–π—Ç–µ', search: '–í–ª–∞–¥–∏ –ö—Ä–∞—Å–∫–∏ –Ω–µ —Å–≥—É—â–∞–π—Ç–µ', year: 2022 }]},
            { id: 'a26', name: '–î—Ä–∞–∫–æ–Ω—å', desc: '–ë–∞—Ä–¥–æ–≤—Å–∫–∏–π —é–º–æ—Ä', emoji: 'üêâ', bgColor: '#ea580c',
              image: '',
              tracks: [{ title: '–û –≤—Å–∞–¥–Ω–∏–∫–∞—Ö –∏ —á–µ—Ä–µ–ø–∞—Ö–∞—Ö', search: '–î—Ä–∞–∫–æ–Ω—å –û –≤—Å–∞–¥–Ω–∏–∫–∞—Ö –∏ —á–µ—Ä–µ–ø–∞—Ö–∞—Ö', year: 2012 },{ title: '–ù–∞–π—Ç–∏ –æ–º–µ–ª—É', search: '–î—Ä–∞–∫–æ–Ω—å –ù–∞–π—Ç–∏ –æ–º–µ–ª—É', year: 2015 },{ title: '–ü–µ—Å–Ω—è –æ –≤–∞—à–µ–º –¥—Ä—É–≥–µ', search: '–î—Ä–∞–∫–æ–Ω—å –ü–µ—Å–Ω—è –æ –≤–∞—à–µ–º –¥—Ä—É–≥–µ', year: 2014 },{ title: '–ò—Å–ø–∞–Ω—Å–∫–∞—è —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–ª–∞–¥–∞', search: '–î—Ä–∞–∫–æ–Ω—å –ò—Å–ø–∞–Ω—Å–∫–∞—è —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è –±–∞–ª–ª–∞–¥–∞', year: 2016 }]},
            { id: 'a27', name: 'Atlantida Project', desc: '–≠—Ç–Ω–æ-—ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞', emoji: 'üåä', bgColor: '#0891b2',
              image: '',
              tracks: [{ title: '–ß–∏—Å—Ç–æ–µ –∑–ª–æ', search: 'Atlantida Project –ß–∏—Å—Ç–æ–µ –∑–ª–æ', year: 2015 },{ title: '–°–∞—Ä–≤–∞ –ú–∞–Ω–≥–∞–ª–∞–º', search: 'Atlantida Project –°–∞—Ä–≤–∞ –ú–∞–Ω–≥–∞–ª–∞–º', year: 2012 },{ title: '–ö—Ä–∞—Å–Ω–∞—è –∫–æ—Ä–æ–ª–µ–≤–∞', search: 'Atlantida Project –ö—Ä–∞—Å–Ω–∞—è –∫–æ—Ä–æ–ª–µ–≤–∞', year: 2018 }]},
            { id: 'a28', name: '–û–ª—å–≥–∞ –ê—Ä–µ—Ñ—å–µ–≤–∞', desc: '–ê–≤—Ç–æ—Ä—Å–∫–∞—è –º–∏—Å—Ç–∏–∫–∞', emoji: 'üîÆ', bgColor: '#a855f7',
              image: '',
              tracks: [{ title: '–°–∞–Ω—Å–∞—Ä–∞', search: '–û–ª—å–≥–∞ –ê—Ä–µ—Ñ—å–µ–≤–∞ –°–∞–Ω—Å–∞—Ä–∞', year: 2000 },{ title: '–í–µ—Ä—Ç–æ–ª—ë—Ç', search: '–û–ª—å–≥–∞ –ê—Ä–µ—Ñ—å–µ–≤–∞ –í–µ—Ä—Ç–æ–ª—ë—Ç', year: 2003 }]},
        ];

        const traits = [
            { id: 't1', name: '–û—Ç–∫—Ä—ã—Ç–æ—Å—Ç—å –æ–ø—ã—Ç—É', color: '#22c55e' },
            { id: 't2', name: '–ê–Ω—Ç–∏–∞–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω–æ—Å—Ç—å', color: '#eab308' },
            { id: 't3', name: '–ö–æ—Å–º–æ–ø–æ–ª–∏—Ç–∏–∑–º', color: '#3b82f6' },
            { id: 't4', name: '–ú–µ–ª–∞–Ω—Ö–æ–ª–∏—è', color: '#8b5cf6' },
            { id: 't5', name: '–°–æ–∑–µ—Ä—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å', color: '#ec4899' },
            { id: 't6', name: '–ò—Ä–æ–Ω–∏—è –∫–∞–∫ –∑–∞—â–∏—Ç–∞', color: '#f97316' },
            { id: 't7', name: '–ê—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç—å', color: '#14b8a6' },
            { id: 't8', name: '–ò–Ω—Ç–µ–ª–ª–∏–≥–µ–Ω—Ü–∏—è', color: '#ef4444' },
        ];

        const genreToArtist = [
            { source: 'soviet-rock', target: 'a1' },
            { source: 'protest', target: 'a3' },{ source: 'protest', target: 'a14' },
            { source: 'world', target: 'a11' },{ source: 'world', target: 'a8' },
            { source: 'spiritual', target: 'a4' },{ source: 'spiritual', target: 'a16' },
            { source: 'author', target: 'a5' },{ source: 'author', target: 'a2' },
            { source: 'neofolk', target: 'a6' },{ source: 'neofolk', target: 'a15' },
            { source: 'electronic', target: 'a12' },{ source: 'electronic', target: 'a7' },
            { source: 'virtuoso', target: 'a8' },{ source: 'virtuoso', target: 'a7' },
            { source: 'irony', target: 'a13' },{ source: 'irony', target: 'a5' },
            { source: 'soundtrack', target: 'a7' },
            { source: 'modern-rap', target: 'a3' },{ source: 'modern-rap', target: 'a9' },{ source: 'modern-rap', target: 'a14' },{ source: 'modern-rap', target: 'a21' },{ source: 'modern-rap', target: 'a25' },
            { source: 'melancholy', target: 'a10' },{ source: 'melancholy', target: 'a1' },{ source: 'melancholy', target: 'a17' },{ source: 'melancholy', target: 'a18' },{ source: 'melancholy', target: 'a20' },
            { source: 'soviet-rock', target: 'a17' },{ source: 'soviet-rock', target: 'a22' },{ source: 'soviet-rock', target: 'a24' },
            { source: 'protest', target: 'a19' },{ source: 'protest', target: 'a23' },{ source: 'protest', target: 'a25' },
            { source: 'electronic', target: 'a18' },
            { source: 'author', target: 'a20' },{ source: 'author', target: 'a26' },{ source: 'author', target: 'a28' },
            { source: 'irony', target: 'a21' },{ source: 'irony', target: 'a26' },
            { source: 'world', target: 'a27' },
            { source: 'spiritual', target: 'a27' },{ source: 'spiritual', target: 'a28' },
        ];

        const artistToTrait = [
            { source: 'a1', target: 't8' },{ source: 'a1', target: 't4' },
            { source: 'a2', target: 't7' },{ source: 'a2', target: 't8' },
            { source: 'a3', target: 't2' },
            { source: 'a4', target: 't5' },{ source: 'a4', target: 't1' },
            { source: 'a5', target: 't6' },{ source: 'a5', target: 't7' },
            { source: 'a6', target: 't1' },{ source: 'a6', target: 't3' },
            { source: 'a7', target: 't1' },
            { source: 'a8', target: 't7' },{ source: 'a8', target: 't3' },
            { source: 'a9', target: 't2' },
            { source: 'a10', target: 't4' },
            { source: 'a11', target: 't3' },{ source: 'a11', target: 't1' },
            { source: 'a12', target: 't1' },
            { source: 'a13', target: 't6' },
            { source: 'a14', target: 't2' },{ source: 'a14', target: 't8' },
            { source: 'a15', target: 't1' },
            { source: 'a16', target: 't5' },
            { source: 'a17', target: 't4' },{ source: 'a17', target: 't8' },
            { source: 'a18', target: 't4' },{ source: 'a18', target: 't1' },
            { source: 'a19', target: 't2' },
            { source: 'a20', target: 't4' },{ source: 'a20', target: 't7' },
            { source: 'a21', target: 't6' },{ source: 'a21', target: 't2' },
            { source: 'a22', target: 't4' },{ source: 'a22', target: 't8' },
            { source: 'a23', target: 't2' },{ source: 'a23', target: 't7' },
            { source: 'a24', target: 't7' },
            { source: 'a25', target: 't2' },
            { source: 'a26', target: 't6' },{ source: 'a26', target: 't7' },
            { source: 'a27', target: 't1' },{ source: 'a27', target: 't5' },
            { source: 'a28', target: 't5' },{ source: 'a28', target: 't7' },
        ];

        let frozenArtistId = null;
        const chartDiv = document.getElementById('sankeyChart');
        const trackPanel = document.getElementById('trackPanel');
        const width = Math.min(1400, window.innerWidth - 40);
        const height = Math.min(900, window.innerHeight - 100);
        const cardSize = Math.max(30, Math.min(50, (height - 40) / 28 - 2));
        const cardWidth = cardSize, cardHeight = cardSize;

        chartDiv.style.width = width + 'px';
        chartDiv.style.height = height + 'px';

        const col1X = 120, col2X = width / 2 - cardWidth / 2, col3X = width - 180;
        genres.forEach((g, i) => { g.y = 20 + i * (height - 40) / genres.length + (height - 40) / genres.length / 2; g.x = col1X; });
        artists.forEach((a, i) => { a.y = 20 + i * (height - 40) / artists.length; a.x = col2X; });
        traits.forEach((t, i) => { t.y = 20 + i * (height - 40) / traits.length + (height - 40) / traits.length / 2; t.x = col3X; });

        const svg = d3.select('#sankeyChart').append('svg').attr('width', width).attr('height', height).style('position', 'absolute').style('top', 0).style('left', 0);

        const linkElements1 = [], linkElements2 = [];
        genreToArtist.forEach(link => {
            const genre = genres.find(g => g.id === link.source), artist = artists.find(a => a.id === link.target);
            linkElements1.push(svg.append('path').attr('class', 'sankey-link')
                .attr('d', `M ${genre.x} ${genre.y} C ${genre.x + 100} ${genre.y}, ${artist.x - 50} ${artist.y + cardHeight/2}, ${artist.x} ${artist.y + cardHeight/2}`)
                .attr('stroke', '#a1a1aa').attr('stroke-width', 1).attr('stroke-opacity', 0.2).datum({ source: link.source, target: link.target }));
        });
        artistToTrait.forEach(link => {
            const artist = artists.find(a => a.id === link.source), trait = traits.find(t => t.id === link.target);
            linkElements2.push(svg.append('path').attr('class', 'sankey-link')
                .attr('d', `M ${artist.x + cardWidth} ${artist.y + cardHeight/2} C ${artist.x + cardWidth + 50} ${artist.y + cardHeight/2}, ${trait.x - 100} ${trait.y}, ${trait.x} ${trait.y}`)
                .attr('stroke', trait.color).attr('stroke-width', 1).attr('stroke-opacity', 0.2).datum({ source: link.source, target: link.target }));
        });

        genres.forEach(genre => {
            const label = document.createElement('div');
            label.className = 'genre-label';
            label.innerHTML = `<span class="genre-dot" style="background: ${genre.color}"></span>${genre.name}`;
            label.style.cssText = `left: 10px; top: ${genre.y - 8}px; color: ${genre.color}`;
            label.dataset.id = genre.id;
            label.onmouseenter = () => { if (!frozenArtistId) highlightFromGenre(genre.id, true); };
            label.onmouseleave = () => { if (!frozenArtistId) highlightFromGenre(genre.id, false); };
            chartDiv.appendChild(label);
        });

        artists.forEach(artist => {
            const card = document.createElement('div');
            card.className = 'artist-card';
            card.style.cssText = `left: ${artist.x}px; top: ${artist.y}px; width: ${cardSize}px; height: ${cardSize}px;`;
            card.dataset.id = artist.id;
            const hasImg = artist.image && artist.image.length > 0;
            const imgUrl = hasImg ? imagePath(artist.image) : '';
            const imgPos = artist.imagePos || 'center top';
            card.innerHTML = `
                <div class="artist-avatar ${hasImg ? '' : 'no-img'}" style="background: ${hasImg ? `url('${imgUrl}') ${imgPos}/cover no-repeat` : `linear-gradient(135deg, ${artist.bgColor}60, ${artist.bgColor}25)`}">
                    <div class="fallback" style="background: linear-gradient(135deg, ${artist.bgColor}60, ${artist.bgColor}25);">${artist.emoji}</div>
                </div>
                <div class="artist-info">
                    <div class="artist-name">${artist.name}</div>
                    <div class="artist-desc">${artist.desc}</div>
                </div>
            `;
            card.onmouseenter = () => { if (!frozenArtistId) { highlightFromArtist(artist.id, true); showTrackPanel(artist, false); } };
            card.onmouseleave = () => { if (!frozenArtistId) { highlightFromArtist(artist.id, false); hideTrackPanel(); } };
            card.onclick = (e) => { e.stopPropagation(); frozenArtistId === artist.id ? unfreezeArtist() : freezeArtist(artist); };
            chartDiv.appendChild(card);
        });

        traits.forEach(trait => {
            const label = document.createElement('div');
            label.className = 'trait-label';
            label.innerHTML = `<span class="trait-bar" style="background: ${trait.color}"></span>${trait.name}`;
            label.style.cssText = `left: ${trait.x + 10}px; top: ${trait.y - 10}px; color: ${trait.color}`;
            label.dataset.id = trait.id;
            label.onmouseenter = () => { if (!frozenArtistId) highlightFromTrait(trait.id, true); };
            label.onmouseleave = () => { if (!frozenArtistId) highlightFromTrait(trait.id, false); };
            chartDiv.appendChild(label);
        });

        function showTrackPanel(artist, frozen) {
            const panelImg = document.getElementById('panelImage');
            const hasImg = artist.image && artist.image.length > 0;
            panelImg.style.background = hasImg ? `url('${imagePath(artist.image)}') center/cover` : `linear-gradient(135deg, ${artist.bgColor}60, ${artist.bgColor}20)`;
            panelImg.innerHTML = hasImg ? '' : `<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-size:28px;">${artist.emoji}</div>`;
            document.getElementById('panelTitle').textContent = artist.name;
            document.getElementById('panelSubtitle').textContent = `${artist.tracks.length} —Ç—Ä–µ–∫–æ–≤`;
            document.getElementById('panelHint').textContent = frozen ? '–ö–ª–∏–∫–Ω–∏ –Ω–∞ —Ç—Ä–µ–∫ ‚Üí Spotify' : '–ö–ª–∏–∫–Ω–∏ –¥–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏';
            const trackList = document.getElementById('trackList');
            trackList.innerHTML = '';
            artist.tracks.forEach(track => {
                const li = document.createElement('li');
                li.className = 'track-item';
                li.innerHTML = `<svg class="spotify-icon" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0C5.4 0 0 5.4 0 12s5.4 12 12 12 12-5.4 12-12S18.66 0 12 0zm5.521 17.34c-.24.359-.66.48-1.021.24-2.82-1.74-6.36-2.101-10.561-1.141-.418.122-.779-.179-.899-.539-.12-.421.18-.78.54-.9 4.56-1.021 8.52-.6 11.64 1.32.42.18.479.659.301 1.02zm1.44-3.3c-.301.42-.841.6-1.262.3-3.239-1.98-8.159-2.58-11.939-1.38-.479.12-1.02-.12-1.14-.6-.12-.48.12-1.021.6-1.141C9.6 9.9 15 10.561 18.72 12.84c.361.181.54.78.241 1.2zm.12-3.36C15.24 8.4 8.82 8.16 5.16 9.301c-.6.179-1.2-.181-1.38-.721-.18-.601.18-1.2.72-1.381 4.26-1.26 11.28-1.02 15.721 1.621.539.3.719 1.02.419 1.56-.299.421-1.02.599-1.559.3z"/></svg><span class="track-name">${track.title}</span><span class="track-arrow">‚Üí</span>`;
                li.onclick = (e) => { e.stopPropagation(); window.open(`https://open.spotify.com/search/${encodeURIComponent(track.search)}`, '_blank'); };
                trackList.appendChild(li);
            });
            trackPanel.classList.add('visible');
            trackPanel.classList.toggle('frozen', frozen);
        }

        function hideTrackPanel() { trackPanel.classList.remove('visible'); }
        function freezeArtist(artist) { if (frozenArtistId) document.querySelector(`.artist-card[data-id="${frozenArtistId}"]`)?.classList.remove('frozen'); frozenArtistId = artist.id; document.querySelector(`.artist-card[data-id="${artist.id}"]`)?.classList.add('frozen'); highlightFromArtist(artist.id, true); showTrackPanel(artist, true); }
        function unfreezeArtist() { if (frozenArtistId) document.querySelector(`.artist-card[data-id="${frozenArtistId}"]`)?.classList.remove('frozen'); frozenArtistId = null; updateHighlight(null, null, null); hideTrackPanel(); }

        document.getElementById('closeBtn').onclick = unfreezeArtist;
        document.onclick = (e) => { if (frozenArtistId && !e.target.closest('.artist-card') && !e.target.closest('.track-panel')) unfreezeArtist(); };

        function highlightFromGenre(id, on) { const a = new Set(), t = new Set(); if (on) { genreToArtist.forEach(l => { if (l.source === id) a.add(l.target); }); artistToTrait.forEach(l => { if (a.has(l.source)) t.add(l.target); }); } updateHighlight(on ? new Set([id]) : null, on ? a : null, on ? t : null); }
        function highlightFromArtist(id, on) { const g = new Set(), t = new Set(); if (on) { genreToArtist.forEach(l => { if (l.target === id) g.add(l.source); }); artistToTrait.forEach(l => { if (l.source === id) t.add(l.target); }); } updateHighlight(on ? g : null, on ? new Set([id]) : null, on ? t : null); }
        function highlightFromTrait(id, on) { const a = new Set(), g = new Set(); if (on) { artistToTrait.forEach(l => { if (l.target === id) a.add(l.source); }); genreToArtist.forEach(l => { if (a.has(l.target)) g.add(l.source); }); } updateHighlight(on ? g : null, on ? a : null, on ? new Set([id]) : null); }

        function updateHighlight(aG, aA, aT) {
            const on = aG !== null;
            document.querySelectorAll('.genre-label').forEach(el => el.classList.toggle('dimmed', on && !aG.has(el.dataset.id)));
            document.querySelectorAll('.artist-card').forEach(el => { if (on) { el.classList.toggle('dimmed', !aA.has(el.dataset.id)); el.classList.toggle('highlighted', aA.has(el.dataset.id) && el.dataset.id !== frozenArtistId); } else el.classList.remove('dimmed', 'highlighted'); });
            document.querySelectorAll('.trait-label').forEach(el => el.classList.toggle('dimmed', on && !aT.has(el.dataset.id)));
            linkElements1.forEach(p => { const d = p.datum(); p.attr('stroke-opacity', on ? (aG.has(d.source) && aA.has(d.target) ? 0.6 : 0.03) : 0.2); });
            linkElements2.forEach(p => { const d = p.datum(); p.attr('stroke-opacity', on ? (aA.has(d.source) && aT.has(d.target) ? 0.6 : 0.03) : 0.2); });
        }
    </script>
</body>
</html>
